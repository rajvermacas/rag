<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RAG Document Chat</title>
  <link rel="stylesheet" href="/static/css/output.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.6/dist/purify.min.js"></script>
</head>
<body class="min-h-screen bg-zinc-100 text-zinc-900">
  <main class="mx-auto max-w-6xl px-4 py-8 md:py-12">
    <header class="mb-8 rounded-2xl border border-zinc-200 bg-white/90 p-6 shadow-xl shadow-zinc-300/40 backdrop-blur">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-red-600">RAG Workspace</p>
        <h1 class="text-3xl font-black tracking-tight text-zinc-950 md:text-4xl">Document Intelligence Chat</h1>
        <p class="mt-2 max-w-2xl text-sm text-zinc-600">
          Upload files, chat with grounded answers, and manage indexed documents in one workspace.
        </p>
      </div>
    </header>

    <nav class="mb-4 flex items-center gap-2 rounded-2xl border border-zinc-200 bg-white p-2 shadow-lg shadow-zinc-300/20" aria-label="Workspace tabs">
      <button
        id="nav-chat"
        type="button"
        class="rounded-xl border border-zinc-900 bg-zinc-900 px-4 py-2 text-sm font-semibold text-white transition"
        aria-selected="true"
      >
        Chat
      </button>
      <button
        id="nav-battleground"
        type="button"
        class="rounded-xl border border-zinc-300 bg-white px-4 py-2 text-sm font-semibold text-zinc-700 transition hover:border-red-500 hover:text-red-600"
        aria-selected="false"
      >
        Battleground
      </button>
    </nav>

    <section
      id="chat-section"
      class="grid gap-6 rounded-2xl border border-zinc-200 bg-white p-4 shadow-xl shadow-zinc-300/30 md:grid-cols-[minmax(20rem,24rem)_1fr] md:p-6"
      data-tab-panel="chat"
    >
      <article class="rounded-xl border border-zinc-200 bg-zinc-50 p-4">
        <h2 class="text-lg font-bold text-zinc-950">Upload Document</h2>
        <p class="mt-1 text-sm text-zinc-600">Accepted formats: PDF, DOCX, TXT.</p>
        <form id="upload-form" class="mt-4 space-y-3">
          <input
            class="w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 file:mr-3 file:rounded-md file:border-0 file:bg-red-600 file:px-3 file:py-2 file:text-sm file:font-semibold file:text-white hover:file:bg-red-700"
            type="file"
            name="file"
            accept=".pdf,.docx,.txt"
            required
          />
          <button
            id="upload-button"
            class="inline-flex w-full items-center justify-center rounded-lg border border-red-700 bg-red-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-red-700 disabled:cursor-not-allowed disabled:opacity-60"
            type="submit"
          >
            <span
              id="upload-loader"
              class="mr-2 hidden h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"
              aria-hidden="true"
            ></span>
            <span id="upload-button-label">Upload</span>
          </button>
        </form>
        <div id="upload-status" class="mt-3 hidden rounded-lg border px-3 py-2 text-sm font-medium"></div>

        <section class="mt-6 rounded-xl border border-zinc-200 bg-white p-3">
          <div class="flex items-center justify-between gap-2">
            <h3 class="text-sm font-bold uppercase tracking-wide text-zinc-700">Indexed Documents</h3>
            <button
              id="refresh-documents"
              class="rounded-md border border-zinc-300 bg-white px-2.5 py-1.5 text-xs font-semibold text-zinc-700 transition hover:border-red-500 hover:text-red-600"
              type="button"
            >
              Refresh
            </button>
          </div>
          <ul id="documents-list" class="mt-3 space-y-2"></ul>
          <p id="documents-status" class="mt-3 text-xs text-zinc-600"></p>
        </section>
      </article>

      <article class="rounded-xl border border-zinc-200 bg-white p-4">
        <h2 class="text-lg font-bold text-zinc-950">Chat</h2>
        <div class="mt-3 flex flex-col gap-2 sm:flex-row sm:flex-nowrap sm:items-center">
          <label for="chat-model-select" class="shrink-0 whitespace-nowrap text-sm font-semibold text-zinc-700">Model</label>
          <select
            id="chat-model-select"
            class="w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20 sm:w-52"
          >
            <option value="" selected>Select model</option>
          </select>
          <label for="chat-history-select" class="shrink-0 whitespace-nowrap text-sm font-semibold text-zinc-700">Chat History</label>
          <select
            id="chat-history-select"
            class="w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20 sm:w-52"
          ></select>
          <button
            id="clear-chat"
            class="shrink-0 whitespace-nowrap rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm font-semibold text-zinc-700 transition hover:border-red-500 hover:text-red-600 sm:ml-auto"
            type="button"
          >
            New Chat
          </button>
        </div>
        <div
          id="chat-window"
          class="mt-3 h-[32rem] overflow-y-auto rounded-xl border border-zinc-200 bg-zinc-50 p-3"
        ></div>
        <form id="chat-form" class="mt-4 flex flex-col gap-3 sm:flex-row" autocomplete="off">
          <input
            class="flex-1 rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20"
            type="text"
            name="message"
            placeholder="Ask a question about uploaded documents..."
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            required
          />
          <button
            id="chat-button"
            class="inline-flex items-center justify-center rounded-lg border border-zinc-900 bg-zinc-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-zinc-800 disabled:cursor-not-allowed disabled:opacity-60"
            type="submit"
          >
            Send
          </button>
        </form>
      </article>
    </section>

    <section
      id="battleground-section"
      class="hidden grid gap-6 rounded-2xl border border-zinc-200 bg-white p-4 shadow-xl shadow-zinc-300/30 md:p-6"
      data-tab-panel="battleground"
    >
      <article class="rounded-xl border border-zinc-200 bg-zinc-50 p-4">
        <h2 class="text-lg font-bold text-zinc-950">Model Battleground</h2>
        <p class="mt-1 text-sm text-zinc-600">Choose two models and compare answers side by side.</p>

        <div id="battleground-model-selection" class="mt-4 flex flex-col gap-3 sm:flex-row">
          <div class="flex-1">
            <label for="model-a-select" class="text-sm font-semibold text-zinc-700">Model A</label>
            <select
              id="model-a-select"
              class="mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20"
              required
            >
              <option value="" selected>Select model A</option>
            </select>
          </div>
          <div class="flex-1">
            <label for="model-b-select" class="text-sm font-semibold text-zinc-700">Model B</label>
            <select
              id="model-b-select"
              class="mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20"
              required
            >
              <option value="" selected>Select model B</option>
            </select>
          </div>
        </div>
        <p id="battleground-status" class="mt-3 text-xs text-zinc-600"></p>
      </article>

      <article id="battleground-comparison-panel" class="min-w-0 rounded-xl border border-zinc-200 bg-white p-4">
        <h3 class="text-lg font-bold text-zinc-950">Battleground Chat</h3>
        <p class="mt-1 text-sm text-zinc-600">Each prompt is sent to both models with shared retrieval context.</p>
        <div class="mt-3 grid gap-3 xl:grid-cols-2">
          <section class="rounded-xl border border-zinc-200 bg-zinc-50 p-3">
            <h4 id="battleground-model-a-title" class="text-sm font-semibold text-zinc-900">Model A</h4>
            <div id="battleground-model-a-output" class="mt-2 h-[32rem] overflow-y-auto rounded-lg border border-zinc-200 bg-white p-3 text-sm text-zinc-700"></div>
          </section>
          <section class="rounded-xl border border-zinc-200 bg-zinc-50 p-3">
            <h4 id="battleground-model-b-title" class="text-sm font-semibold text-zinc-900">Model B</h4>
            <div id="battleground-model-b-output" class="mt-2 h-[32rem] overflow-y-auto rounded-lg border border-zinc-200 bg-white p-3 text-sm text-zinc-700"></div>
          </section>
        </div>
        <form id="battleground-form" class="mt-4 flex flex-col gap-3 sm:flex-row">
          <input
            id="battleground-message"
            class="flex-1 rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 outline-none transition focus:border-red-500 focus:ring-2 focus:ring-red-500/20"
            type="text"
            placeholder="Ask a question for both models..."
            required
          />
          <button
            id="battleground-submit"
            class="inline-flex items-center justify-center rounded-lg border border-zinc-900 bg-zinc-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-zinc-800"
            type="submit"
          >
            Send
          </button>
        </form>
      </article>
    </section>
  </main>

  <script src="/static/js/common.js"></script>
  <script src="/static/js/chat.js"></script>
  <script src="/static/js/battleground.js"></script>
</body>
</html>
